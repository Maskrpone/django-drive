{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>File Manager</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/stylepath.css' %}" />
    <script src="{% static 'js/script.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <!-- Bande de navigation supérieure -->
    <div class="header">
      <!-- Breadcrumb Navigation -->
        <a href="{% url 'drive_root' %}">Home</a>
        {% for key, value in breadcrumbs.items %}
          {% if key %}
            <a href="{% url 'drive' value %}">{{ key }}</a>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Titre principal -->
    <div class="title">
      <div class="text">My Files</div>
      <div class="btn-flow">
        <i class="fas fa-plus"></i>
      </div>
    </div>

    <div class="main-container">
      <!-- Section gauche : Bouton Nouveau avec menu déroulant -->
      <div class="left-section">
        
        <div class="main-container">
          <!-- Section gauche : Bouton Nouveau avec menu déroulant -->
          <div class="left-section">
            <div class="new-button-container">
              <button class="new-button"><?xml version="1.0" ?><svg style="enable-background:new 0 0 24 24;" version="1.1" viewBox="0 0 24 24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="info"/><g id="icons"><path d="M12,1C5.9,1,1,5.9,1,12s4.9,11,11,11s11-4.9,11-11S18.1,1,12,1z M17,14h-3v3c0,1.1-0.9,2-2,2s-2-0.9-2-2v-3H7   c-1.1,0-2-0.9-2-2c0-1.1,0.9-2,2-2h3V7c0-1.1,0.9-2,2-2s2,0.9,2,2v3h3c1.1,0,2,0.9,2,2C19,13.1,18.1,14,17,14z" id="add"/></g></svg> Nouveau</button>
              <div class="dropdown-menu" id="dropdown-menu">
                <a href="#" class="dropdown-item" data-target="create-folder-modal">Créer un dossier</a>
                <a href="#" class="dropdown-item" data-target="upload-file-modal">Ajouter un fichier</a>
              </div>
            </div>
          </div>
    
          <!-- Pop-up pour Créer un dossier -->
          <div class="modal-overlay" id="modal-overlay"></div>
          <div class="modal" id="create-folder-modal">
            <div class="modal-content">
              <span class="close-button" data-target="create-folder-modal">&times;</span>
              <h1>Create a folder</h1>
              <form method="POST" action="{% url 'create_folder' %}" class="add-folder-form">
                {% csrf_token %}
                <input type="hidden" name="current_path" value="{{ current_path }}">
                <input type="text" name="folder_name" placeholder="New folder name" class="folder-name-input">
                <button type="submit" class="create-folder-button">Create Folder</button>
              </form>
            </div>
          </div>
    
          <!-- Pop-up pour Téléverser un fichier -->
          <div class="modal-overlay" id="upload-modal-overlay"></div>
          <div class="modal" id="upload-file-modal">
            <div class="modal-content">
              <span class="close-button" data-target="upload-file-modal">&times;</span>
              <h1>Upload a file</h1>
              <form method="POST" enctype="multipart/form-data" action="{% url 'upload_file' %}" class="upload-file-form">
                {% csrf_token %}
                <input type="hidden" name="current_path" value="{{ current_path }}">
                {{ form.as_p }}
                <button type="submit" class="upload-file-button">Upload File</button>
              </form>
            </div>
          </div>
    
    <!-- JavaScript -->
        <script>
          // Gestion du menu déroulant "Nouveau"
          const newButton = document.querySelector('.new-button');
          const dropdownMenu = document.querySelector('#dropdown-menu');
          newButton.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
          });
          document.addEventListener('click', (e) => {
            if (!newButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
              dropdownMenu.style.display = 'none';
            }
          });
    
          // Gestion des pop-ups
          const overlay = document.querySelectorAll('.modal-overlay');
          const openModalButtons = document.querySelectorAll('.dropdown-item');
          const closeModalButtons = document.querySelectorAll('.close-button');
    
          // Ouvre la pop-up
          openModalButtons.forEach(button => {
            button.addEventListener('click', (e) => {
              e.preventDefault();
              const targetModal = button.getAttribute('data-target');
              document.getElementById(targetModal).style.display = 'block';
              document.getElementById(targetModal).previousElementSibling.style.display = 'block';
            });
          });
    
          // Ferme la pop-up
          closeModalButtons.forEach(button => {
            button.addEventListener('click', () => {
              const targetModal = button.getAttribute('data-target');
              document.getElementById(targetModal).style.display = 'none';
              document.getElementById(targetModal).previousElementSibling.style.display = 'none';
            });
          });
    
          // Ferme la pop-up en cliquant sur l'overlay
          overlay.forEach(item => {
            item.addEventListener('click', () => {
              item.style.display = 'none';
              item.nextElementSibling.style.display = 'none';
            });
          });
        </script>

        
      

        
      </div>
    </div>

    <!-- Section du tableau de fichiers -->
    <div class="table-box">
      <table class="table">
        <thead class="table__head">
          <tr>
            <th></th>
            <th>Title</th>
            <th></th>
          </tr>
        </thead>
        <tbody class="table__body">
          <!-- Exemple d'éléments de tableau -->
          <tr>
            <td><i class="file-icon fas fa-folder"></i></td>
            <!-- Section des dossiers -->
        <div class="folder-section">
         
          <ul class="folder-list">

            {% for folder in folders %}
              <li class="folder-item">
                <a href="{% url 'drive' current_path|add:folder|add:'/' %}" class="folder-link">{{ folder }}
                  <i class="fas fa-folder"></i> <?xml version="1.0" ?><svg height="24" version="1.1" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><g transform="translate(0 -1028.4)"><path d="m12 1034.4c0 1.1-0.895 2-2 2h-5-3c-1.1046 0-2 0.9-2 2v8 3c0 1.1 0.89543 2 2 2h20c1.105 0 2-0.9 2-2v-3-10c0-1.1-0.895-2-2-2h-10z" fill="#2980b9"/><path d="m2 2c-1.1046 0-2 0.8954-2 2v5h10v1h14v-5c0-1.1046-0.895-2-2-2h-10.281c-0.346-0.5969-0.979-1-1.719-1h-8z" fill="#2980b9" transform="translate(0 1028.4)"/><path d="m12 1033.4c0 1.1-0.895 2-2 2h-5-3c-1.1046 0-2 0.9-2 2v8 3c0 1.1 0.89543 2 2 2h20c1.105 0 2-0.9 2-2v-3-10c0-1.1-0.895-2-2-2h-10z" fill="#3498db"/></g></svg>
                  <span class="folder-name">{{ folder }}</span> <!-- Texte du dossier caché -->
                </a>
                <span class="options-icon" data-filepath="{{ current_path|add:folder|add:'/' }}">...</span>
                <div class="folder-menu" id="menu-{{ folder }}">
                  <ul>
                    <li class="delete-option" data-filepath="{{ current_path|add:folder|add:'/' }}">Supprimer</li>
                    <li class="move-option" data-filepath="{{ current_path|add:folder|add:'/' }}">Déplacer</li>
                    <li class="copy-option" data-filepath="{{ current_path|add:folder|add:'/' }}">Copier</li>
                  </ul>
                </div>
              </li>
            {% empty %}
              <li class="no-folder">No folders</li>
            {% endfor %}
          </ul>
        </div>

    <!-- JavaScript -->
    <script>
      // Gestion du menu déroulant "Nouveau"
      const newButton = document.querySelector('.new-button');
      const dropdownMenu = document.querySelector('#dropdown-menu');
      newButton.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
      });
      document.addEventListener('click', (e) => {
        if (!newButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.style.display = 'none';
        }
      });

      // Gestion des pop-ups
      const overlay = document.querySelectorAll('.modal-overlay');
      const openModalButtons = document.querySelectorAll('.dropdown-item');
      const closeModalButtons = document.querySelectorAll('.close-button');

      // Ouvre la pop-up
      openModalButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          e.preventDefault();
          const targetModal = button.getAttribute('data-target');
          document.getElementById(targetModal).style.display = 'block';
          document.getElementById(targetModal).previousElementSibling.style.display = 'block';
        });
      });

      // Ferme la pop-up
      closeModalButtons.forEach(button => {
        button.addEventListener('click', () => {
          const targetModal = button.getAttribute('data-target');
          document.getElementById(targetModal).style.display = 'none';
          document.getElementById(targetModal).previousElementSibling.style.display = 'none';
        });
      });

      // Ferme la pop-up en cliquant sur l'overlay
      overlay.forEach(item => {
        item.addEventListener('click', () => {
          item.style.display = 'none';
          item.nextElementSibling.style.display = 'none';
        });
      });
    </script>


        <!-- INES -->
        <!-- Section des fichiers -->
        <div class="file-section">
    
          <ul class="file-list">
            {% for file in files %}
              <li class="file-item">
                <a href="{{ file }}" class="file-link">{{ file }}</a>
                <span class="options-icon" data-filepath="{{ file }}">...</span>
                <div class="file-menu" id="menu-{{ file }}">
                  <ul>
                    <li class="copy-option" data-filepath="{{ file }}">Copier</li>
                    <li class="move-option" data-filepath="{{ file }}">Déplacer</li>
                    <li class="delete-option" data-filepath="{{ file }}">Supprimer</li>
                  </ul>
                </div>
              </li>
            {% empty %}
              <li class="no-file">No files</li>
            {% endfor %}
          </ul>
        </div>

      </div>
            <td><i class="fas fa-ellipsis-v" data-behavior="file-settings"></i>
              <ul class="file-menu collapsed">
                <li>Rename</li>
                <li>Move</li>
                <li>Delete</li>
                <li>Properties</li>
              </ul>
            </td>
          </tr>
          <!-- Ajouter ici d'autres fichiers ou dossiers -->
        </tbody>
      </table>
    </div>

    <script>
      // Gestion du menu d'options
      $('.options-icon').click(function() {
        const filepath = $(this).data('filepath');
        $(`#menu-${filepath}`).toggle();
      });

      // Autres actions JavaScript ici...
    </script>
  </body>
</html>
